<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍽️ 1週間の献立表 🍰</title>
    <link rel="icon" href="https://icon-pit.com/wp-content/uploads/2018/10/recipe_icon_2-300x300.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --base-font-size: 16px;
            --text-color: #5c5c5c;
            --primary-color: #ff8c94;
            --light-pink: #ffe0e6;
            --bg-color: #fff0f5;
        }
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            line-height: 1.7;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            font-size: var(--base-font-size);
            -webkit-tap-highlight-color: transparent;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 700;
        }
        p.description {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            background-color: #fff9c4;
            padding: 10px 15px;
            border-radius: 10px;
            display: inline-block;
        }
        .description-wrapper { text-align: center; }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 30px;
            border: 1px solid var(--light-pink);
            border-radius: 15px;
            overflow: hidden;
        }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--light-pink); vertical-align: top; }
        th { background-color: var(--light-pink); color: #d96d79; font-weight: 700; }
        tr:last-child td { border-bottom: none; }
        td[contenteditable="true"] { cursor: text; transition: background-color 0.3s; }
        td[contenteditable="true"]:empty:before { content: attr(data-placeholder); color: #bbb; font-style: italic; cursor: text; }
        td[data-label="献立"] { background-color: #fffde7; }
        td[data-label="献立"]:focus { background-color: #fff9c4; outline: 2px solid #ffb3c1; }
        td[data-label="必要な具材"] { background-color: #f0fff0; }
        td[data-label="必要な具材"]:focus { background-color: #e0f7fa; outline: 2px solid #80deea; }
        .day-of-week { font-weight: bold; color: #d96d79; width: 100px; background-color: #fff !important; }
        .share-container { text-align: center; }
        .action-button { display: inline-block; padding: 12px 30px; background: linear-gradient(45deg, #ff8c94, #ffb3c1); color: #fff; text-decoration: none; border-radius: 50px; font-weight: bold; font-size: 1em; transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(255, 140, 148, 0.4); border: none; cursor: pointer; }
        .action-button:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(255, 140, 148, 0.5); }
        .memo-container { margin-top: 40px; text-align: center; }
        .memo-container h2 { color: #d96d79; margin-bottom: 15px; font-size: 1.2em; }
        .memo-container textarea { width: 100%; height: 200px; padding: 15px; border-radius: 15px; border: 1px solid var(--light-pink); font-family: 'M PLUS Rounded 1c', sans-serif; font-size: 1em; line-height: 1.6; resize: vertical; box-sizing: border-box; }
        .memo-container textarea:focus { outline: 2px solid #ffb3c1; border-color: #ffb3c1; }

        /* Image Upload Styles */
        .image-upload-wrapper { position: relative; }
        .image-upload { width: 0; height: 0; overflow: hidden; }
        .upload-label { display: inline-block; padding: 10px 15px; background-color: #f0f0f0; border-radius: 8px; cursor: pointer; text-align: center; font-size: 0.9em; transition: background-color 0.2s; }
        .upload-label:hover { background-color: #e0e0e0; }
        .meal-image { display: none; border-radius: 10px; margin-top: 10px; max-width: 150px; max-height: 150px; }
        .remove-image-btn { display: none; position: absolute; top: 15px; right: 5px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; line-height: 24px; text-align: center; cursor: pointer; }

        /* --- iPhone Optimization --- */
        @media (max-width: 768px) {
            body { padding: 10px; font-size: 15px; }
            .container { padding: 15px; }
            h1 { font-size: 1.8em; }
            table { border: none; border-radius: 0; background: transparent; }
            table, thead, tbody, th, td, tr { display: block; }
            thead tr { display: none; }
            tr { border: none; border-radius: 15px; margin-bottom: 20px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); background: #fff; }
            td { border: none; border-bottom: 1px solid #f5f5f5; position: relative; padding: 15px; padding-left: 38%; min-height: 50px; }
            td:before { position: absolute; left: 15px; width: 35%; padding-right: 10px; white-space: nowrap; text-align: left; font-weight: bold; content: attr(data-label); color: var(--primary-color); }
            td:last-child { border-bottom: none; }
            td.day-of-week { padding: 12px 15px; text-align: center; background-color: var(--primary-color) !important; color: white; font-size: 1.3em; border-radius: 15px 15px 0 0; }
            td.day-of-week:before { display: none; }
            td[contenteditable] { -webkit-user-select: text; user-select: text; }
            .meal-image { max-width: 100%; height: auto; max-height: 180px; object-fit: cover; margin-top: 10px; width: 100%; }
            .upload-label { width: 100%; box-sizing: border-box; }
            .remove-image-btn { top: 15px; right: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🍽️ 1週間の献立表 🍰</h1>
        <div class="description-wrapper"><p class="description">「献立」と「具材」欄はタップして編集できます✨</p></div>
        <table id="meal-table">
            <thead>
                <tr><th>曜日</th><th>🍳 献立</th><th>🛒 必要な具材</th><th>📸 写真</th></tr>
            </thead>
            <tbody>
                <!-- Day Rows Will be Inserted Here by JS -->
            </tbody>
        </table>
        <div class="share-container"><button id="share-btn" class="action-button">画像で共有</button></div>
        <div class="memo-container">
            <h2>📝 その他メモ</h2>
            <textarea placeholder="買い物リストや気づいたことなどを自由にメモできます..."></textarea>
        </div>
    </div>

    <script>
        const days = ['月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日', '日曜日'];
        const tbody = document.querySelector('#meal-table tbody');

        // Generate table rows dynamically
        days.forEach((day, index) => {
            const dayId = day.substring(0, 2);
            const row = `
                <tr>
                    <td class="day-of-week" data-label="曜日">${day}</td>
                    <td data-label="献立" contenteditable="true" data-placeholder="今日のメニューは？"></td>
                    <td data-label="必要な具材" contenteditable="true" data-placeholder="お買い物リスト"></td>
                    <td data-label="写真">
                        <div class="image-upload-wrapper">
                            <input type="file" accept="image/*" class="image-upload" id="image-upload-${dayId}">
                            <label for="image-upload-${dayId}" class="upload-label">📸 写真を追加</label>
                            <img class="meal-image" alt="食事の写真">
                            <button type="button" class="remove-image-btn">&times;</button>
                        </div>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });

        // Image Sharing Logic
        const shareButton = document.getElementById('share-btn');
        const elementToCapture = document.getElementById('meal-table');
        shareButton.addEventListener('click', () => {
            const originalOverflow = elementToCapture.style.overflow;
            elementToCapture.style.overflow = 'visible';

            html2canvas(elementToCapture, { useCORS: true, scrollY: -window.scrollY, backgroundColor: '#ffffff' }).then(canvas => {
                elementToCapture.style.overflow = originalOverflow;
                canvas.toBlob(async (blob) => {
                    if (!blob) return;
                    const fileName = '1週間の献立表.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });

                    try {
                        if (navigator.canShare && navigator.canShare({ files: [file] })) {
                            await navigator.share({
                                files: [file],
                                title: '1週間の献立表',
                                text: '今週の献立表です！'
                            });
                        } else {
                            throw new Error('Web Share API not supported.');
                        }
                    } catch (error) {
                        console.warn('Web Share failed, falling back to download:', error);
                        const a = document.createElement('a');
                        a.href = URL.createObjectURL(blob);
                        a.download = fileName;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    }
                }, 'image/jpeg', 0.95);
            }).catch(error => {
                elementToCapture.style.overflow = originalOverflow;
                console.error('html2canvas failed:', error);
            });
        });

        // Image Upload & Remove Logic
        document.querySelectorAll('.image-upload-wrapper').forEach(wrapper => {
            const input = wrapper.querySelector('.image-upload');
            const label = wrapper.querySelector('.upload-label');
            const img = wrapper.querySelector('.meal-image');
            const removeBtn = wrapper.querySelector('.remove-image-btn');

            input.addEventListener('change', e => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = event => {
                    img.src = event.target.result;
                    img.style.display = 'block';
                    removeBtn.style.display = 'block';
                    label.style.display = 'none';
                };
                reader.readAsDataURL(file);
            });

            removeBtn.addEventListener('click', () => {
                input.value = null;
                img.src = '';
                img.style.display = 'none';
                removeBtn.style.display = 'none';
                label.style.display = 'inline-block';
            });
        });
    </script>
</body>
</html>
